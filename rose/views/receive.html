<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>RoseToMe</title>
    <meta name="format-detection" content="telephone=no">
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="css/mui.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="js/mui.min.js"></script>
    <script src="js/mustache.min.js"></script>
    <script src="javascripts/socketio.js"></script>
    <script src="javascripts/client_flowers.js"></script>
    <style>
        .login {
            width: 90%;
            height: 165px;
            margin: 5%;
            padding: 20px 10px;
            border: 1px solid #eee
        }
        
        .btn {
            background-color: #ccc;
            width: 40%
        }
        
        .message {
            width: 30%;
            float: left;
            padding: 2px;
            border: 1px solid #ccc;
            margin-top: 6px;
            border-radius: 8px;
            text-align: center;
            background-color: #ccc;
            font-size: 12px
        }
    </style>
</head>

<body background="#fff">
    <div class="header"><img src="img/logo.png" class="title"></div>
    <div class="login">
        <form class="mui-input-group">
            <div class="mui-input-row"><label>手机号：</label><input type="text" class="mui-input-clear" placeholder="请输入手机号" maxlength="11" id="telInput"></div>
            <div class="mui-input-row"><label>短信验证码：</label><input type="text" style="width:30%;float:left" placeholder="验证码" id="code">
                <div class="message" onclick="getIdentifyCode()" id="identify">获取验证码</div>
            </div>
            <div class="mui-button-row" style="margin-top:10px"><button type="button" class="mui-btn btn" onclick="handleCommentSubmit()">确定</button></div>
        </form>
        <div class="footer">
            <a href="tel:4001-510-521">
                <p style="margin:0"><span class="mui-icon mui-icon-phone" style="font-size:20px"></span>4001-510-521</p>
            </a>
            <p style="margin:0">甄选世界顶级玫瑰，只为最深爱意表达</p>
        </div>
    </div>
    <div id="over" class="over2" style="display:none"></div>
    <div id="layout" class="layout" style="display:none">
        <div class="loading"><i></i> <i></i> <i></i> <i></i> <i></i> <i></i> <i></i> <i></i></div>
        <p class="loading-text">正在登陆，请稍后～</p>
    </div>
</body>
<script>
    function telCheck(e) {
        var t = /^1[34578]\d{9}$/;
        return !!t.test(e)
    }

    function getIdentifyCode(e) {
        telCheck(document.getElementById("telInput").value) ? identityMessage(document.getElementById("telInput").value, "RoseToMe", new function() {
            this.successCallback = function(e) {
                document.getElementById("identify").onclick = null, identifyCode = e, mui.toast("验证码已发送，请注意查收！"), console.log(e)
            }, this.errorCallback = function(e) {
                console.log("failed" + e)
            }, this.connectCallback = function(e) {
                console.log("connectSucceed" + e)
            }, this.disconnectCallback = function(e) {
                console.log("disconnect" + e)
            }, this.socketErrorCallback = function(e) {
                console.log("socketError" + e)
            }, this.newMessageCallback = function(e) {
                console.log("newMessages：" + JSON.stringify(e))
            }
        }) : mui.toast("您输入的电话号码有误，请检查！")
    }

    function handleCommentSubmit() {
        if ("" == document.getElementById("telInput").value) mui.toast("手机号码不能为空！");
        else if (document.getElementById("code").value !== identifyCode) mui.toast("短信验证码错误，请重新输入！");
        else {
            showLoading();
            var e = document.getElementById("telInput").value;
            readWish(e, "RoseToMe", new function() {
                this.successCallback = function(e) {
                    localStorage.clear(), localStorage.setItem("head", e[0].head), localStorage.setItem("content", e[0].content), localStorage.setItem("name", e[0].name), hideLoading(), window.location.href = "/reMain"
                }, this.errorCallback = function(e) {
                    console.log("failed" + e)
                }, this.connectCallback = function(e) {
                    console.log("connectSucceed" + e)
                }, this.disconnectCallback = function(e) {
                    console.log("disconnect" + e)
                }, this.socketErrorCallback = function(e) {
                    console.log("socketError" + e)
                }, this.newMessageCallback = function(e) {
                    console.log("newMessages：" + JSON.stringify(e))
                }
            })
        }
    }

    function hideLoading() {
        document.getElementById("over").style.display = "none", document.getElementById("layout").style.display = "none"
    }

    function showLoading() {
        document.getElementById("over").style.display = "block", document.getElementById("layout").style.display = "block"
    }
    var identifyCode
</script>

</html>