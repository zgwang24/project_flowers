<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>RoseToMe</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" href="css/mui.css">
    <link rel="stylesheet" href="css/main.css">
    <script src="js/mui.min.js"></script>
    <script src="js/mustache.min.js"></script>
    <script src="javascripts/socketio.js"></script>
    <script src="javascripts/client_flowers.js"></script>
    <style></style>
</head>

<body background="#fff">
    <div class="header"><img src="img/logo.png" class="title"></div>
    <div class="login">
        <form class="mui-input-group">
            <div class="mui-input-row"><label>手机号：</label><input type="text" class="mui-input-clear" placeholder="请输入手机号" maxlength="11" oninput="handleCommentInputChange(event)" id="telInput"></div>
            <div class="mui-input-row"><label>密码：</label><input type="password" class="mui-input-password" placeholder="请输入密码" id="passInput"></div>
            <div class="mui-button-row" style="margin-top:10px"><button type="button" class="mui-btn btn left" onclick="handleCommentSubmit()">登录</button> <a href="/register"><button type="button" class="mui-btn btn">注册</button></a></div>
            <a href="/forgetPass">
                <div class="pass">忘记密码?</div>
            </a>
        </form>
        <div class="footer">
            <a href="tel:4001-510-521">
                <p style="margin:0"><span class="mui-icon mui-icon-phone" style="font-size:20px"></span>4001-510-521</p>
            </a>
            <p style="margin:0">甄选世界顶级玫瑰，只为最深爱意表达</p>
        </div>
    </div>
    <div id="over" class="over2" style="display:none"></div>
    <div id="layout" class="layout" style="display:none">
        <div class="loading"><i></i> <i></i> <i></i> <i></i> <i></i> <i></i> <i></i> <i></i></div>
        <p class="loading-text">正在登陆，请稍后～</p>
    </div>
</body>
<script>
    function telCheck(e) {
        var t = /^1[34578]\d{9}$/;
        return !!t.test(e)
    }

    function handleCommentInputChange(e) {
        var t = e.target.value;
        t.length > 11 && mui.toast("手机号码不能超过11位")
    }

    function handleCommentSubmit() {
        if ("" == document.getElementById("telInput").value) mui.toast("手机号码不能为空！");
        else if ("" == document.getElementById("passInput").value) mui.toast("密码不能为空");
        else if (telCheck(document.getElementById("telInput").value)) {
            showLoading();
            var e = document.getElementById("telInput").value,
                t = document.getElementById("passInput").value;
            console.log("==>>>" + e, t), login(e, t, new function() {
                this.successCallback = function(t) {
                    localStorage.setItem("loginPhone", e), window.location.href = "/main", hideLoading()
                }, this.errorCallback = function(e) {
                    mui.toast("密码错误"), hideLoading()
                }, this.connectCallback = function(e) {
                    console.log("connectSucceed" + e)
                }, this.disconnectCallback = function(e) {
                    console.log("disconnect" + e)
                }, this.socketErrorCallback = function(e) {
                    console.log("socketError" + e)
                }, this.newMessageCallback = function(e) {
                    console.log("newMessages：" + JSON.stringify(e))
                }
            })
        } else mui.toast("您输入的电话号码有误，请检查！")
    }

    function hideLoading() {
        document.getElementById("over").style.display = "none", document.getElementById("layout").style.display = "none"
    }

    function showLoading() {
        document.getElementById("over").style.display = "block", document.getElementById("layout").style.display = "block"
    }
</script>

</html>