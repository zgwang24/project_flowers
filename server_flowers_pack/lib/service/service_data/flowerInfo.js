var mongoose=require("./mongodb"),Schema=mongoose.Schema,wish=new Schema({head:String,content:String,name:String,date:{type:Date,default:Date.now},plateform:String,orderId:String,getPhone:String,order:String}),flowerSchema=new Schema({setPhone:String,phone:String,wishes:[wish],flowerShop:String}),flowerInfoModel=mongoose.model("wishinfos",flowerSchema),FlowerInfo=function(){},flowerInfoInstance=null;FlowerInfo.prototype.createWish=function(e,o){flowerInfoModel.findOne({setPhone:e.setPhone,phone:e.phone,flowerShop:e.flowerShop},function(n,r){n?console.log(n+"Read in error."):null==r?(console.log("No record, you need create a record."),flowerInfoInstance=new flowerInfoModel(e),flowerInfoInstance.save(o)):(console.log("Need update a record."),r.wishes.push(e.wishes[0]),r.save(o))})},FlowerInfo.prototype.readWishByPhoneAndShop=function(e,o,n){flowerInfoModel.find({phone:e,flowerShop:o},function(e,o){if(e)console.log(e+"Read in error.");else if(null==o)n(e,o);else{for(var r=new Array,l=0;l<o.length;l++)for(var s=0;s<o[l].wishes.length;s++)r.push(o[l].wishes[s]);n(e,r.reverse())}})},FlowerInfo.prototype.readWishBySetPhoneAndShop=function(e,o,n,r){null==o?flowerInfoModel.find({setPhone:e,flowerShop:n},function(e,o){if(e)console.log(e+"read by setPhone in error.");else if(null==o)r(e,o);else{for(var n=new Array,l=0;l<o.length;l++)for(var s=0;s<o[l].wishes.length;s++)n.push(o[l].wishes[s]);r(e,n.reverse())}}):flowerInfoModel.find({setPhone:e,phone:o,flowerShop:n},function(e,o){if(e)console.log(e+"read by setPhone in error.");else if(null==o)r(e,o);else{for(var n=new Array,l=0;l<o.length;l++)for(var s=0;s<o[l].wishes.length;s++)n.push(o[l].wishes[s]);r(e,n.reverse())}})},module.exports=new FlowerInfo;